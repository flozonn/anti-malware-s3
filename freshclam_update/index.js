import { spawnSync } from 'child_process'


async function handler (event, context) {

  console.log('updating virus database in mounted EFS ...')
  const freshclamUpdate = spawnSync(
    'freshclam',
    [
      '--verbose',
      '--stdout',
      '--debug',
      '--datadir=/mnt/efs/database',
      '--config-file=/opt/bin/freshclam.conf'
    ],
    {
      encoding: 'utf-8',
      stdio: 'pipe'
    }
  )
  console.log('Freshclam update:', JSON.stringify(freshclamUpdate, null, 2))
  return
}
export { handler }

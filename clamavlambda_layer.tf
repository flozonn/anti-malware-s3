
resource "aws_lambda_layer_version" "clamav_layer" {
  layer_name               = "clamav_layer"
  compatible_runtimes      = ["nodejs20.x"]
  compatible_architectures = ["x86_64"]
  s3_bucket                = aws_s3_bucket.playground_archi_lambda_layers.id
  s3_key                   = aws_s3_object.clamav_layer.id
  source_code_hash         = filebase64sha256("${path.module}/clamav_lambda_layer/clamav_lambda_layer.zip")
}

// bucket containing the layer

resource "aws_s3_bucket" "playground_archi_lambda_layers" {
  bucket = "playground-archi-lambda-layers"
  acl    = "private"
}

# Cr√©ation de l'objet dans le bucket
resource "aws_s3_object" "clamav_layer" {
  bucket      = aws_s3_bucket.playground_archi_lambda_layers.id
  key         = "clamav_layer"
  source      = "${path.module}/clamav_lambda_layer/clamav_lambda_layer.zip"
  source_hash = filebase64sha256("${path.module}/clamav_lambda_layer/clamav_lambda_layer.zip")

}

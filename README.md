# s3-antimalware

Ce repo contient un systÃ¨me basÃ©e sur une layer lambda qui utilise les binaires freshclam et clamav.  

- Tous les jours freshclam_update se dÃ©clenche pour mettre Ã  jour la base virale
- A chaque putObject dans le bucket S3, mw_detector se dÃ©clenche pour faire une analyse de l'objet:
    - si l'objet est un virus identifiÃ© alors il est tagguÃ© en consÃ©quence
    - en cas de virus identifiÃ© un email est envoyÃ©


## SchÃ©ma

![archi](./anti-malware%20S3.jpg)



## Version lambda layer: Modifier la layer

Mettre a jour la layer:

```
cd ./clamav_lambda_layer
docker build -t clamav_lambda_layer -f Dockerfile --no-cache .
docker run --name clamav_lambda_layer clamav_lambda_layer
docker cp clamav_lambda_layer:/home/build/clamav_lambda_layer.zip .
terraform plan
terraform apply


```



## Version image docker: Mettre Ã  jour l'image de la lambda mw_detector

Cela aura pour consÃ©quence de mettre Ã  jour la base virale Ã©galement.

En utilisant le makefile dans le rÃ©pertoire /clamav_lambda_container:

```
make update TAG=0.0.11 AWS_PROFILE=playground_archi
```

Puis 

```
terraform plan
terraform apply
```


## Description

Version + moderne du challenge dÃ©crit ici: https://arbauri.atlassian.net/wiki/spaces/AR/pages/20860076038/Challenge+Lambda+Antimalware


ğŸ“‹ L'image docker contient la base de virus. 

ğŸ“‹ La lamdba doit avoir un timeout surpÃ©rieur Ã  5 minutes

ğŸ“‹ La mÃ©moire RAM de la lambda doit Ãªtre supÃ©rieure Ã  4 GB 


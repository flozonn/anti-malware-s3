# s3-antimalware

Ce repo contient un système basée sur une layer lambda qui utilise les binaires freshclam et clamav.  

- Tous les jours freshclam_update se déclenche pour mettre à jour la base virale
- A chaque putObject dans le bucket S3, mw_detector se déclenche pour faire une analyse de l'objet:
    - si l'objet est un virus identifié alors il est taggué en conséquence
    - en cas de virus identifié un email est envoyé


## Schéma

![archi](./anti-malware%20S3.jpg)



## Version lambda layer: Modifier la layer

Mettre a jour la layer:

```
cd ./clamav_lambda_layer
docker build -t clamav_lambda_layer -f Dockerfile --no-cache .
docker run --name clamav_lambda_layer clamav_lambda_layer
docker cp clamav_lambda_layer:/home/build/clamav_lambda_layer.zip .
terraform plan
terraform apply

```
